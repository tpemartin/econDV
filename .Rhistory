readLines("drake_init_lines.R") -> drake_plan_wrapper
usethis::use_data(drake_plan_wrapper)
devtools::document()
library(econDV)
library(econDV)
library(econDV)
library(econDV)
install.packages("googlesheets4")
gen_RprofileTemplateData = function(){
rprojroot::is_r_package -> pkgroot
pkgroot$make_fix_file() -> pkgrootfile
file.path(
pkgrootfile(),"RprofileTemplate.R"
) -> templatefilename
readLines(
templatefilename
) -> RprofileLines
usethis::use_data(RprofileLines, overwrite = T)
}
gen_RprofileTemplateData()
library(econDV)
library(econDV)
dir.create("plans")
library(jsonlite)
library(jsonlite)
targetUrl <- "https://data.ntpc.gov.tw/api/datasets/71CD1490-A2DF-4198-BEF1-318479775E8A/json"
library(jsonlite)
library(googlesheets4)
plan01 <- drake::drake_plan(
list_newTaipeiYouBike=fromJSON(
targetUrl, simplifyDataFrame = F), # list class
df_newTaipeiYouBike=fromJSON(
targetUrl), # data.frame class
startSalary={
read_sheet(
"https://docs.google.com/spreadsheets/d/1PPWeFGqedVsgZmV81MeA0oJDCBkj5upkHltlWap7xUY/edit#gid=1835013852",
skip=3
)
}
)
install.packages("drake")
library(googlesheets4)
plan01 <- drake::drake_plan(
list_newTaipeiYouBike=fromJSON(
targetUrl, simplifyDataFrame = F), # list class
df_newTaipeiYouBike=fromJSON(
targetUrl), # data.frame class
startSalary={
read_sheet(
"https://docs.google.com/spreadsheets/d/1PPWeFGqedVsgZmV81MeA0oJDCBkj5upkHltlWap7xUY/edit#gid=1835013852",
skip=3
)
}
)
source('~/Github/econDV/plans/data01.R', echo=TRUE)
make(plan01)
mk_data01 %<-% {
make(plan01)
}
library(drake); library(future)
mk_data01 %<-% {
make(plan01)
}
usethis:use_data(data01)
usethis::use_data(data01)
library(econDV)
data01
library(econDV)
data01
load("~/Dropbox/github-data/df_cpiTW.rda")
load("~/Dropbox/github-data/df_inflationTW.rda")
data01$df_cpiTW <- df_cpiTW
data01$df_inflationTW <- df_inflationTW
usethis::use_data(data01)
usethis::use_data(data01, overwrite = T)
library(econDV)
library(econDV)
load("~/Dropbox/github-data/world_inflation.rda")
data01$world_inflation <- world_inflation
usethis::use_data(data01, overwrite = T)
q()
usethis::use_package("SOAR")
library(econDV)
library(econDV)
library(econDV)
library(econDV)
devtools::document()
library(econDV)
library(econDV)
devtools::document()
library(econDV)
library(econDV)
q()
devtools::document()
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
devtools::document()
library(econDV)
library(econDV)
library(econDV)
library(econDV)
devtools::document()
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
knitr::knit_params(readLines("test.Rmd"))
knitr::knit_params(readLines("test.Rmd")) -> aa
is.null(aa)
str(aa)
length(aa=0)
length(aa==0)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(testthat)
plan_name="/itemk/plan.....R"
plan_name="/itemk/plan.....R"
plan_name1=stringr::str_extract(plan_name,"(?<=/)[:alnum:]+")
plan_name1
plan_name1=stringr::str_extract(plan_name,"(?<=/)[[:alnum:]\\.]+")
plan_name1=stringr::str_extract(plan_name,"(?<=/)[[:alnum:]\\.]+$")
plan_name1
planfilepath=stringr::str_extract("[:graph:]+(?=plan_nam1)")
planfilepath=stringr::str_extract(plan_name,"[:graph:]+(?=plan_nam1)")
planfilepath
glue::glue("[:graph:]+(?={plan_name1})")
planfilepath=stringr::str_extract(plan_name,
glue::glue("[:graph:]+(?={plan_name1})"))
planfilepath
plan_name="plan.....R"
plan_name1=stringr::str_extract(plan_name,"(?<=/)[[:alnum:]\\.]+$")
plan_name1
ifelse(is.na(plan_name1), plan_name, plan_name1)
plan_nameExtract=stringr::str_extract(plan_name,"(?<=/)[[:alnum:]\\.]+$")
plan_name0=ifelse(is.na(plan_nameExtract), plan_name, plan_nameExtract)
plan_name0=stringr::str_replace(plan_name0,".R","")
plan_name0
planfilepath=
ifelse(
is.na(plan_nameExtract),
"",
stringr::str_extract(plan_name,
glue::glue("[:graph:]+(?={plan_name1})"))
)
planfilepath
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
assert_pkg("downloader")
install.packages("downloader")
usethis::use_package("downloader")
library(readr)
Taiwan_E5_9C_8B_E6_B0_91_E6_89_80_E5_BE_97_E7_B5_B1_E8_A8_88_E5_B8_B8_E7_94_A8_E8_B3_87_E6_96_99 <- read_csv("https://www.dropbox.com/s/d5v23cab2b74y5i/Taiwan%E5%9C%8B%E6%B0%91%E6%89%80%E5%BE%97%E7%B5%B1%E8%A8%88%E5%B8%B8%E7%94%A8%E8%B3%87%E6%96%99.csv?dl=1",
locale = locale(encoding = "BIG5"), skip = 3)
View(Taiwan_E5_9C_8B_E6_B0_91_E6_89_80_E5_BE_97_E7_B5_B1_E8_A8_88_E5_B8_B8_E7_94_A8_E8_B3_87_E6_96_99)
knitr::opts_chunk$set(echo = TRUE)
library(drake)
install.packages("drake")
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(readr)
taiwanStatistics <- read_csv(
file_in("https://www.dropbox.com/s/d5v23cab2b74y5i/Taiwan%E5%9C%8B%E6%B0%91%E6%89%80%E5%BE%97%E7%B5%B1%E8%A8%88%E5%B8%B8%E7%94%A8%E8%B3%87%E6%96%99.csv?dl=1"),
locale = locale(encoding = "BIG5"), skip = 3)
downloaddata = {
library(readr)
taiwanStatistics <- read_csv(
file_in("https://www.dropbox.com/s/d5v23cab2b74y5i/Taiwan%E5%9C%8B%E6%B0%91%E6%89%80%E5%BE%97%E7%B5%B1%E8%A8%88%E5%B8%B8%E7%94%A8%E8%B3%87%E6%96%99.csv?dl=1"),
locale = locale(encoding = "BIG5"), skip = 3)
taiwanStatistics
}
downloaddata %>%
names()
library(readr)
library(dplyr)
downloaddata %>%
names()
downloaddata %>%
rename(
"年"="X1"
) %>%
names()
downloaddata %>%
rename(
"年"="X1"
) %>%
mutate(
across(
everything(),
as.numberic
)
)
downloaddata %>%
rename(
"年"="X1"
) %>%
mutate(
across(
everything(),
as.numeric
)
)
dataReady = {
downloaddata %>%
rename(
"年"="X1"
) %>%
mutate(
across(
everything(),
as.numeric
)
)
}
{
dataReady %>%
ggplot()+
geom_line(
aes(
x=年, y=`經濟成長(%)`
)
)
}
library(ggplot2)
{
dataReady %>%
ggplot()+
geom_line(
aes(
x=年, y=`經濟成長(%)`
)
)
}
gg_taiwanEconomicGrowth = {
dataReady %>%
ggplot()+
geom_line(
aes(
x=年, y=`經濟成長(%)`
)
)
}
gg_taiwanEconomicGrowth
library(econDV)
rlang::sym("plan0")
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(econDV)
purl_drakePlan(
filename=paste0(params$planname,".R"),
planname=rlang::sym(params$planname)
)
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(econDV)
purl_drakePlan(
filename=paste0(params$planname,".R"),
plan_name=rlang::sym(params$planname)
)
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(econDV)
purl_drakePlan(
filename=paste0(params$planname,".R"),
plan_name=params$planname
)
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(econDV)
purl_drakePlan(
filename=paste0(params$planname,".R"),
plan_name=params$planname
)
purl_drakePlan(
filename="myplan.R",
plan_name=params$planname
)
purl_drakePlan(
filename="./document/myplan.R",
plan_name=params$planname
)
purl_drakePlan(
filename="/Users/martin/Github/econDV/document/myplan.Rmd",
plan_name=params$planname
)
library(purrr)
library(econDV)
purl_drakePlan(
filename="/Users/martin/Github/econDV/document/myplan.Rmd",
plan_name=params$planname
)
source('~/Github/econDV/R/drake.R', echo=TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(drake)
library(purrr)
library(econDV)
purl_drakePlan(
filename="/Users/martin/Github/econDV/document/myplan.Rmd",
plan_name=params$planname
)
planname="plan_taiwanBusinessCycles"
readLines(
"/Users/martin/Github/econDV/document/planRmdTemplate.Rmd"
) -> planRmdTemplate
usethis::use_data(planRmdTemplate,internal=T)
usethis::use_data(planRmdTemplate,internal=T, overwrite=T)
readLines(
"/Users/martin/Github/econDV/document/planRmdTemplate.Rmd"
) -> planRmdTemplate
usethis::use_data(planRmdTemplate,internal=T, overwrite=T)
library(econDV)
library(econDV)
planRmdTemplate
econDV::planRmdTemplate
readLines(
"/Users/martin/Github/econDV/document/planRmdTemplate.Rmd"
) -> planRmdTemplate
title=NULL
root=NULL
readLines(
"/Users/martin/Github/econDV/document/planRmdTemplate.Rmd"
) -> planRmdTemplate
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
planname="plan_taiwanBusinessCycles"
title=NULL
root=NULL
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
planRmdTemplate %>%
stringr::str_replace(
"\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
) -> myRmdLines
library(dplyr)
planRmdTemplate %>%
stringr::str_replace(
"\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
) -> myRmdLines
planRmdTemplate %>%
stringr::str_replace(
"\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
) -> myRmdLines
planRmdTemplate %>%
stringr::str_replace_all(
"\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
) -> myRmdLines
planRmdTemplate %>%
stringr::str_replace_all(
"\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname))
) -> myRmdLines
library(stringr)
planRmdTemplate %>%
stringr::str_replace_all(
c("\\{title\\}"=ifelse(is.null(title),planname,title),
"\\{planname\\}"=planname,
"\\{filename\\}"=
ifelse(is.null(root),
file.path(getwd(),planname),
file.path(root,planname)))
) -> myRmdLines
View(myRmdLines)
writeLines(
myRmdLines,
paste0(planname,".Rmd")
)
library(econDV)
library(econDV)
devtools::document()
devtools::document()
rm(list = c("planRmdTemplate"))
devtools::document()
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
library(econDV)
devtools::document()
library(econDV)
library(econDV)
library(shiny)
runApp('test')
install.packages("flexdashboard")
library(dplyr); library(xml2)
filename <- "/Users/martin/Github/economic-data-visualization/courses/temp/gg_startSalaryCompare_base.svg"
xml0 <- xml2::read_xml(filename)
svgNode <- xml2::xml_parent(xml0)
symbolNode <- xml2::read_xml("<symbol id='sample'></symbol>")
xml0 %>%
xml_add_child(symbolNode) -> xmlnew
xml2::write_html(xmlnew,
file='new.svg')
xml0 <- xml2::read_xml(filename)
xml0 %>%
xml_add_child(symbolNode) -> xmlnew
xml2::write_html(xmlnew,
file='new.svg')
filename <- "/Users/martin/Github/economic-data-visualization/courses/temp/gg_startSalaryCompare_base.svg"
xml0 <- xml2::read_xml(filename)
xml0
symbolNode <- xml2::read_xml("<symbol id='sample'></symbol>")
xml0 %>%
xml_add_child(symbolNode) -> xmlnew
xml2::write_html(xmlnew,
file='new.svg')
install.packages("XML")
svgfile <-
"/Users/martin/Github/course-HS-society-and-citizen/img/gg_GDPRank_base3.svg")
svgfile <-
"/Users/martin/Github/course-HS-society-and-citizen/img/gg_GDPRank_base3.svg"
htmltools::withTags(
object(
type="image/svg+xml",
data=svgfile))
svgfile <-
"/Users/martin/Github/course-HS-society-and-citizen/img/gg_GDPRank_base3.svg"
insertSVG <- function(svgfile){
htmltools::withTags(
object(
type="image/svg+xml",
data=svgfile))
}
insertSVG(svgfile)
devtools::document()
library(econDV)
library(econDV)
162*12
153/180
library(econDV)
usethis::use_rmarkdown_template("Drake plan")
knitr::opts_chunk$set(echo = TRUE, eval=F)
library(drake)
library(emajorDV)
library(dplyr)
# 不同plan, new_cache裡的名字要不同
cacheNew <- drake::new_cache('cachename')
options(rstudio_drake_cache = cacheNew$storr)
purlActiveRmd_thenPlanMake()
knitr::opts_chunk$set(echo = TRUE, eval=F)
library(drake)
library(emajorDV)
library(dplyr)
# 不同plan, new_cache裡的名字要不同
cacheNew <- drake::new_cache('.cachename')
options(rstudio_drake_cache = cacheNew$storr)
purlActiveRmd_thenPlanMake()
knitr::opts_chunk$set(echo = TRUE, eval=F)
library(drake)
library(emajorDV)
library(dplyr)
# 不同plan, new_cache裡的名字要不同
cacheNew <- drake::new_cache('.cachename')
options(rstudio_drake_cache = cacheNew$storr)
purlActiveRmd_thenPlanMake()
vis_plan
vis_plan()
make(targets=save_gg_taiwanEconomicGrowth)
make(plan_skeleton, targets=save_gg_taiwanEconomicGrowth)
make(plan_skeleton, targets="save_gg_taiwanEconomicGrowth")
vis_plan()
devtools::document()
devtools::document()
library(econDV)
